<!--
 * Copyright (c) 2017 Contributors to the Eclipse Foundation
 *
 * See the NOTICE file(s) distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This program and the accompanying materials are made available under the
 * terms of the Eclipse Public License 2.0 which is available at
 * http://www.eclipse.org/legal/epl-2.0, or the Apache Software License 2.0
 * which is available at https://www.apache.org/licenses/LICENSE-2.0.
 *
 * SPDX-License-Identifier: EPL-2.0 OR Apache-2.0

-->

<div class="container rounded"
     style="padding: 3px; position: absolute; user-select: none;"
     [style.top]="nodeAttributes.y + 'px'"
     [style.left]="nodeAttributes.x + 'px'"
     id={{nodeAttributes.id}} [style.borderColor]="nodeAttributes.color" [style.shadowColor]="nodeAttributes.color"
     (mousedown)="mouseDownHandler($event)"
     (mouseup)="mouseUpHandler($event)"
     [@onCreateNodeTemplateAnimation]='visibilityState'
     [class.removeZIndex]="removeZIndex">
    <div class="row rounded col-sm-12"
         [class.selected]="makeSelectionVisible"
         [class.unselected]="!makeSelectionVisible"
         (click)="openSidebar($event); closeConnectorEndpoints($event)">
        <div class="col-sm-1" style="padding: 0;">
            <table class="table table-responsive table-active table-border--grey table-sm header-table">
                <tr style="padding: 0">
                    <td class="td-maxinstances"
                        [class.flashminmax]="setMaxFlash">{{nodeAttributes.maxInstances}}
                    </td>
                </tr>
                <tr>
                    <td class="table-spacer"><br/></td>
                </tr>
                <tr style="padding: 0">
                    <td class="td-mininstances"
                        [class.flashminmax]="setMinFlash">{{nodeAttributes.minInstances}}
                    </td>
                </tr>
            </table>
        </div>
        <div class="col-sm-3">
            <img *ngIf="!nodeAttributes.imageUrl" src="http://via.placeholder.com/50x50"
                 style="border-radius: 10%; margin-top: 1px; width: 50px; height: auto">
            <img *ngIf="nodeAttributes.imageUrl" src="{{hostURL}}{{nodeAttributes.imageUrl}}">
        </div>
        <div id="specifierDiv" class="col-sm-8" style="padding-left: 0; padding-right: 0;">
            <table class="table table-active table-sm header-table">
                <tr [class.flashit]="setFlash" class="row col-sm-12">
                    <td class="text-right td-value col-sm-12">{{nodeAttributes.name}}</td>
                </tr>
                <tr *ngIf="navbarButtonsState.buttonsState.idsButton" class="row col-sm-12">
                    <td class="text-right td-value col-sm-12" style="text-decoration: underline;">{{nodeAttributes.id}}</td>
                </tr>
                <tr *ngIf="navbarButtonsState.buttonsState.typesButton" class="row col-sm-12">
                    <td class="text-right btn-link td-value col-sm-12">({{nodeTypeLocalName}})</td>
                </tr>
            </table>
        </div>
    </div>
    <div class="endpointContainer container rounded" style="border: 0; width: 205px; box-shadow: none"
         *ngIf="connectorEndpointVisible"
         (mouseover)="makeSource($event)">
        <div class="btn-group-vertical btn-group-sm" role="group" id={{dragSource}}
             (mousedown)="passCurrentType($event)">
            <button *ngFor="let rel of allRelationshipTypesColors"
                    type="button" class="btn btn-sm btn-outline-secondary relationship-button sm"
                    [style.border-color]="this.nodeAttributes.color" [style.color]="rel.color"
                    style="font-size: x-small;">
                <i class="fa fa-arrow-circle-o-right" aria-hidden="true"></i> {{rel.type}}
            </button>
        </div>
    </div>

    <!-- Repaint jsPlumb on every accordion click -->
    <accordion #accordion (click)="repaint($event)">
        <!-- PROPERTIES -->
        <accordion-group
            #propertiesgroup
            panelClass="accordionGroupPanel"
            *ngIf="navbarButtonsState.buttonsState.propertiesButton">
            <div accordion-heading>
                properties
                <i class="pull-sm-0 float-sm-right fa icon-styling padding-top--2px"
                   [ngClass]="{'fa-chevron-down': propertiesgroup?.isOpen, 'fa-chevron-right': !propertiesgroup?.isOpen}"
                ></i>
            </div>
            <winery-properties
                (toggleModalHandler)="sendToggleAction($event)"
                [currentNodeData]="{currentNodeId: nodeAttributes.id,
                                    currentNodeType: nodeAttributes.type,
                                    currentNodePart: 'PROPERTIES'}"
                [currentProperties]="nodeAttributes.properties"
                [groupedNodeTypes]="entityTypes.groupedNodeTypes">
            </winery-properties>
        </accordion-group>

        <!-- DEPLOYMENT ARTIFACTS -->
        <accordion-group
            #deploymentartifactsgroup
            panelClass="accordionGroupPanel"
            *ngIf="navbarButtonsState.buttonsState.deploymentArtifactsButton">
            <div accordion-heading>
                Deployment Artifacts
                <i class="pull-sm-0 float-sm-right fa icon-styling padding-top--2px"
                   [ngClass]="{'fa-chevron-down': deploymentartifactsgroup?.isOpen,
           'fa-chevron-right': !deploymentartifactsgroup?.isOpen}"
                ></i>
            </div>
            <winery-deployment-artifacts
                (toggleModalHandler)="sendToggleAction($event)"
                [currentNodeData]="{currentNodeId: nodeAttributes.id,
                                    currentNodePart: 'DEPLOYMENT_ARTIFACTS',
                                    currentProperties: nodeAttributes.deploymentArtifacts}">
            </winery-deployment-artifacts>
        </accordion-group>

        <!-- REQUIREMENTS-->
        <accordion-group
            #requirementsgroup
            panelClass="accordionGroupPanel"
            *ngIf="navbarButtonsState.buttonsState.requirementsCapabilitiesButton">
            <div accordion-heading>
                Requirements
                <i class="pull-sm-0 float-sm-right fa icon-styling padding-top--2px"
                   [ngClass]="{'fa-chevron-down': navbarButtonsState.buttonsState.requirementsCapabilitiesButton,
           'fa-chevron-right': !navbarButtonsState.buttonsState.requirementsCapabilitiesButton}"
                ></i>
            </div>
            <winery-requirements
                (toggleModalHandler)="sendToggleAction($event)"
                [currentNodeData]="{currentNodeId: nodeAttributes.id,
                                    currentNodePart: 'REQUIREMENTS',
                                    currentProperties: nodeAttributes.requirements}">
            </winery-requirements>
        </accordion-group>

        <!-- CAPABILITIES -->
        <accordion-group
            #capabilitiesgroup
            panelClass="accordionGroupPanel"
            *ngIf="navbarButtonsState.buttonsState.requirementsCapabilitiesButton">
            <div accordion-heading>
                Capabilities
                <i class="pull-sm-0 float-sm-right fa icon-styling padding-top--2px"
                   [ngClass]="{'fa-chevron-down': navbarButtonsState.buttonsState.requirementsCapabilitiesButton,
           'fa-chevron-right': !navbarButtonsState.buttonsState.requirementsCapabilitiesButton}"
                ></i>
            </div>
            <winery-capabilities
                (toggleModalHandler)="sendToggleAction($event)"
                [currentNodeData]="{
                                    currentNodeId: nodeAttributes.id,
                                    currentNodePart: 'CAPABILITIES',
                                    currentProperties: nodeAttributes.capabilities}">
            </winery-capabilities>
        </accordion-group>

        <!-- POLICIES -->
        <accordion-group
            #policiesgroup
            panelClass="accordionGroupPanel"
            *ngIf="navbarButtonsState.buttonsState.policiesButton">
            <div accordion-heading>
                Policies
                <i class="pull-sm-0 float-sm-right fa icon-styling padding-top--2px"
                   [ngClass]="{'fa-chevron-down': policiesgroup?.isOpen, 'fa-chevron-right': !policiesgroup?.isOpen}">
                </i>
            </div>
            <winery-policies
                (toggleModalHandler)="sendToggleAction($event)"
                [currentNodeData]="{currentNodeId: nodeAttributes.id,
                                    currentNodePart: 'POLICIES',
                                    currentProperties: nodeAttributes.policies}">
            </winery-policies>
        </accordion-group>

        <!-- TARGET LOCATIONS -->
        <accordion-group
            #targetlocationsgroup
            panelClass="accordionGroupPanel"
            *ngIf="navbarButtonsState.buttonsState.targetLocationsButton">
            <div accordion-heading>
                Target Locations
                <i class="pull-sm-0 float-sm-right fa icon-styling padding-top--2px"
                   [ngClass]="{'fa-chevron-down': targetlocationsgroup?.isOpen,
           'fa-chevron-right': !targetlocationsgroup?.isOpen}">
                </i>
            </div>
            <winery-target-locations
                [currentNodeData]="{currentNodeId: nodeAttributes.id,
                                    currentNodePart: 'TARGET_LOCATIONS',
                                    currentProperties: nodeAttributes.targetLocations}">
            </winery-target-locations>
        </accordion-group>
    </accordion>
</div>
