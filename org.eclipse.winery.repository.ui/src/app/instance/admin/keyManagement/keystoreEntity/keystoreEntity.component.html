<!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  ~ Copyright (c) 2018 Contributors to the Eclipse Foundation
  ~
  ~ See the NOTICE file(s) distributed with this work for additional
  ~ information regarding copyright ownership.
  ~
  ~ This program and the accompanying materials are made available under the
  ~ terms of the Eclipse Public License 2.0 which is available at
  ~ http://www.eclipse.org/legal/epl-2.0, or the Apache Software License 2.0
  ~ which is available at https://www.apache.org/licenses/LICENSE-2.0.
  ~
  ~ SPDX-License-Identifier: EPL-2.0 OR Apache-2.0
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
<div [class.hidden]="!loading">
    <winery-loader></winery-loader>
</div>
<div *ngIf="!loading">
    <winery-table [columns]="columns[keystoreEntityType]"
                  [data]="data[keystoreEntityType]"
                  (cellSelected)="onCellSelect($event)"
                  (addBtnClicked)="onAddClick()"
                  [enableOtherPurposeButton]="true"
                  (otherPurposeBtnClicked)="onInfoClick()"
                  (removeBtnClicked)="onRemoveClick($event)">
    </winery-table>


    <winery-modal bsModal #addKeyModal="bs-modal" [modalRef]="addKeyModal">
        <winery-modal-header [title]="'Add Key'">
        </winery-modal-header>
        <winery-modal-body>
            <form #addKeyForm="ngForm" id="addKeyForm">
                <label>Algorithm</label>
                <ng-select #algoList
                           [items]="supportedAlgorithms"
                           (selected)="targetAlgorithmSelected($event)"
                           required
                           placeholder="no algorithm selected">
                </ng-select>
                <br/>
                <div *ngIf="addKeyData && addKeyData.algorithm">
                    <label>Key Size</label>
                    <ng-select #keySizesList
                               [items]="supportedAlgorithmsKeySizesMap[addKeyData.algorithm]"
                               (selected)="targetKeySizeSelected($event)"
                               required
                               placeholder="no key size selected">
                    </ng-select>
                </div>
                <br/>
                <label for="fileUploader">Upload key file (will be uploaded when clicking on "Save")</label>
                <input type="file" id="fileUploader" name="fileUploader" (change)="keySelected($event)"/>
                <br/>
            </form>
        </winery-modal-body>
        <winery-modal-footer
            (onOk)="addKey(); addKeyForm.reset();"
            [closeButtonLabel]="'Cancel'"
            [okButtonLabel]="'Add'"
            [disableOkButton]="!addKeyForm?.form.valid">
        </winery-modal-footer>
    </winery-modal>

    <winery-modal bsModal #confirmDeleteModal="bs-modal" [modalRef]="confirmDeleteModal">
        <winery-modal-header>
            <h4 class="modal-title">Delete Keystore Entity</h4>
        </winery-modal-header>
        <winery-modal-body>
            <p *ngIf="selectedCell != null" id="diagyesnomsg">
                Do you want to delete the following keystore entity <span style="font-weight:bold;">{{ selectedCell.row.alias}}</span>?
            </p>
        </winery-modal-body>
        <winery-modal-footer (onOk)="deleteEntity();"
                             [closeButtonLabel]="'No'"
                             [okButtonLabel]="'Delete'">
        </winery-modal-footer>
    </winery-modal>

    <winery-modal bsModal #keyInfoModal="bs-modal" [modalRef]="keyInfoModal">
        <winery-modal-header [title]="'Key Details'"></winery-modal-header>
        <winery-modal-body>
            <div *ngIf="selectedCell" class="panel panel-default">
                <div class="panel-body">
                    <div *ngFor="let key of Object.keys(selectedCell.row)" class="row">
                        <label class="col-sm-2 control-label">{{key.charAt(0).toUpperCase() + key.slice(1)}}</label>
                        <div class="col-sm-8">
                            <p>{{selectedCell.row[key]}}</p>
                        </div>
                    </div>
                </div>
            </div>
        </winery-modal-body>

        <winery-modal-footer
            [showDefaultButtons]="false">
            <button type="button" class="btn btn-primary" (click)="keyInfoModal.hide()">Close</button>
        </winery-modal-footer>

    </winery-modal>

    <winery-modal bsModal #keypairInfoModal="bs-modal" [modalRef]="keypairInfoModal">
        <winery-modal-header [title]="'Keypair Details'"></winery-modal-header>
        <winery-modal-body>
            <div *ngIf="selectedCell" class="panel panel-default">
                <div class="panel-body">
                    <div *ngFor="let key of Object.keys(selectedCell.row)" class="row">
                        <label class="col-sm-2 control-label">{{key.charAt(0).toUpperCase() + key.slice(1)}}</label>
                        <div class="col-sm-8">
                            <p>{{selectedCell.row[key]}}</p>
                        </div>
                    </div>
                </div>
            </div>
        </winery-modal-body>

        <winery-modal-footer
            [showDefaultButtons]="false">
            <button type="button" class="btn btn-primary" (click)="keypairInfoModal.hide()">Close</button>
        </winery-modal-footer>

    </winery-modal>

    <winery-modal bsModal #certificateInfoModal="bs-modal" [modalRef]="certificateInfoModal">
        <winery-modal-header [title]="'Certificate Details'"></winery-modal-header>
        <winery-modal-body>

        </winery-modal-body>

        <winery-modal-footer
            [showDefaultButtons]="false">
            <button type="button" class="btn btn-primary" (click)="certificateInfoModal.hide()">Close</button>
        </winery-modal-footer>

    </winery-modal>
</div>

