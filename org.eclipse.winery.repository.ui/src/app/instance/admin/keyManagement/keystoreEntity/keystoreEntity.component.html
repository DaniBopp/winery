<!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  ~ Copyright (c) 2018 Contributors to the Eclipse Foundation
  ~
  ~ See the NOTICE file(s) distributed with this work for additional
  ~ information regarding copyright ownership.
  ~
  ~ This program and the accompanying materials are made available under the
  ~ terms of the Eclipse Public License 2.0 which is available at
  ~ http://www.eclipse.org/legal/epl-2.0, or the Apache Software License 2.0
  ~ which is available at https://www.apache.org/licenses/LICENSE-2.0.
  ~
  ~ SPDX-License-Identifier: EPL-2.0 OR Apache-2.0
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
<div [class.hidden]="!loading">
    <winery-loader></winery-loader>
</div>
<div *ngIf="!loading">
    <winery-table [columns]="columns[keystoreEntityType]"
                  [data]="data[keystoreEntityType]"
                  (cellSelected)="onCellSelect($event)"
                  (addBtnClicked)="onAddClick()"
                  [enableOtherPurposeButton]="true"
                  (otherPurposeBtnClicked)="onInfoClick()">
        <!--(removeBtnClicked)="onRemoveClick($event)">-->
    </winery-table>


    <winery-modal bsModal #addModal="bs-modal" [modalRef]="addModal">
        <winery-modal-header [title]="'Add'">
        </winery-modal-header>
        <winery-modal-body>
            <form #addKeystoreEntityForm="ngForm" id="addKeystoreEntityForm">
                <div *ngIf="keystoreEntityType === 'secretkeys' || keystoreEntityType === 'keypairs'" class="form-group">
                    <label>Algorithm</label>
                    <ng-select #algoList
                               name="algo"
                               [items]="supportedAlgorithms"
                               [(ngModel)]="currentSelectedItem.algorithm"
                               required
                               placeholder="no algorithm selected">
                    </ng-select>
                    <div *ngIf="currentSelectedItem && currentSelectedItem.algorithm">
                        <label>Key Size</label>
                        <ng-select #keySizesList
                                   name="keySize"
                                   [items]="supportedAlgorithmsKeySizesMap[currentSelectedItem.algorithm]"
                                   [(ngModel)]="currentSelectedItem.keySizeInBits"
                                   required
                                   placeholder="no key size selected">
                        </ng-select>
                    </div>

                </div>

            </form>

        </winery-modal-body>
        <winery-modal-footer
            (onOk)="addKeystoreEntity(); addKeystoreEntityForm.reset();"
            [closeButtonLabel]="'Cancel'"
            [okButtonLabel]="'Add'"
            [disableOkButton]="!addKeystoreEntityForm?.form.valid">
        </winery-modal-footer>
    </winery-modal>


    <winery-modal bsModal #keyInfoModal="bs-modal" [modalRef]="keyInfoModal">
        <winery-modal-header [title]="'Key Details'"></winery-modal-header>
        <winery-modal-body>
            <div *ngIf="selectedCell" class="panel panel-default">
                <div class="panel-body">
                    <div *ngFor="let key of Object.keys(selectedCell.row)" class="row">
                        <label class="col-sm-2 control-label">{{key.charAt(0).toUpperCase() + key.slice(1)}}</label>
                        <div class="col-sm-8">
                            <p>{{selectedCell.row[key]}}</p>
                        </div>
                    </div>
                </div>
            </div>
        </winery-modal-body>

        <winery-modal-footer
            [showDefaultButtons]="false">
            <button type="button" class="btn btn-primary" (click)="keyInfoModal.hide()">Close</button>
        </winery-modal-footer>

    </winery-modal>

    <winery-modal bsModal #keypairInfoModal="bs-modal" [modalRef]="keypairInfoModal">
        <winery-modal-header [title]="'Keypair Details'"></winery-modal-header>
        <winery-modal-body>
            <div *ngIf="selectedCell" class="panel panel-default">
                <div class="panel-body">
                    <div *ngFor="let key of Object.keys(selectedCell.row)" class="row">
                        <label class="col-sm-2 control-label">{{key.charAt(0).toUpperCase() + key.slice(1)}}</label>
                        <div class="col-sm-8">
                            <p>{{selectedCell.row[key]}}</p>
                        </div>
                    </div>
                </div>
            </div>
        </winery-modal-body>

        <winery-modal-footer
            [showDefaultButtons]="false">
            <button type="button" class="btn btn-primary" (click)="keypairInfoModal.hide()">Close</button>
        </winery-modal-footer>

    </winery-modal>

    <winery-modal bsModal #certificateInfoModal="bs-modal" [modalRef]="certificateInfoModal">
        <winery-modal-header [title]="'Certificate Details'"></winery-modal-header>
        <winery-modal-body>

        </winery-modal-body>

        <winery-modal-footer
            [showDefaultButtons]="false">
            <button type="button" class="btn btn-primary" (click)="certificateInfoModal.hide()">Close</button>
        </winery-modal-footer>

    </winery-modal>
</div>


<!--<winery-modal bsModal #addModal="bs-modal" [modalRef]="addModal"
              (onShown)="onAddModalShown();" (onHide)="addPropertyFrom.reset();">
    <winery-modal-header [title]="'Add Property'">
    </winery-modal-header>
    <winery-modal-body>
        <form #addPropertyFrom="ngForm" id="addPropertyForm">
            <div class="form-group">
                <label class="control-label" for="key">Name</label>
                <input #nameInputForm
                       #propName="ngModel"
                       id="key"
                       class="form-control"
                       type="text"
                       name="key"
                       autocomplete=off
                       required
                       [(ngModel)]="newProperty.key"
                       [wineryDuplicateValidator]="validatorObject"/>

                <div *ngIf="propName.errors && (propName.dirty || propName.touched)"
                     class="alert alert-danger">
                    <div [hidden]="!propName.errors.wineryDuplicateValidator">
                        No duplicates allowed!
                    </div>
                    <div [hidden]="!propName.errors.required">
                        Name is required
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="control-label" for="propType">Type</label>
                <select #selectProperty name="type" class="form-control" id="propType">
                    <option value="xsd:string">xsd:string</option>
                    <option value="xsd:float">xsd:float</option>
                    <option value="xsd:decimal">xsd:decimal</option>
                    <option value="xsd:anyURI">xsd:anyURI</option>
                    <option value="xsd:QName">xsd:QName</option>
                </select>
            </div>
        </form>
    </winery-modal-body>
    <winery-modal-footer (onOk)="addProperty(selectProperty.value, propName.value); addPropertyFrom.reset();"
                         [closeButtonLabel]="'Cancel'"
                         [okButtonLabel]="'Add'"
                         [disableOkButton]="!addPropertyFrom?.form.valid">
    </winery-modal-footer>
</winery-modal>

<winery-modal bsModal #confirmDeleteModal="bs-modal" [modalRef]="confirmDeleteModal">
    <winery-modal-header [title]="'Delete Property'">
    </winery-modal-header>
    <winery-modal-body>
        <p *ngIf="elementToRemove != null" id="diagyesnomsg">
            Do you want to delete the Element <span style="font-weight:bold;">{{ elementToRemove.key }}</span>?
        </p>
    </winery-modal-body>
    <winery-modal-footer (onOk)="removeConfirmed();"
                         [closeButtonLabel]="'Cancel'"
                         [okButtonLabel]="'Delete'">
    </winery-modal-footer>
</winery-modal>-->

