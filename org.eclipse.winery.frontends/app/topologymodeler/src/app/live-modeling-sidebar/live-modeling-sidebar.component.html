<!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  ~ Copyright (c) 2019 Contributors to the Eclipse Foundation
  ~
  ~ See the NOTICE file(s) distributed with this work for additional
  ~ information regarding copyright ownership.
  ~
  ~ This program and the accompanying materials are made available under the
  ~ terms of the Eclipse Public License 2.0 which is available at
  ~ http://www.eclipse.org/legal/epl-2.0, or the Apache Software License 2.0
  ~ which is available at https://www.apache.org/licenses/LICENSE-2.0.
  ~
  ~ SPDX-License-Identifier: EPL-2.0 OR Apache-2.0
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->

<div class="live-modeling-sidebar-root"
     mwlResizable
     [validateResize]="validateResize"
     [enableGhostResize]="true"
     [resizeEdges]="{bottom: false, right: false, top: false, left: true}"
     (resizeEnd)="onResizeEnd($event)"
     [style.width.px]="sidebarButtonState === 'top' ? this.sidebarWidth : toggleButton.offsetHeight"
     [style.paddingTop.px]="this.top">
    <button [@sidebarButtonState]="sidebarButtonState" id="toggleButton" class="btn btn-primary" type="button"
            (click)="toggleSidebarState()"
            #toggleButton>
        <span>Live-Modeling </span>
        <span [hidden]="liveModelingState === liveModelingStates.DISABLED" class="fa-stack fa-1x">
          <i class="fa fa-circle fa-stack-1x" style="color: red; opacity: 0.5; font-size: 1.6em"></i>
          <i class="fa fa-circle fa-stack-1x" style="color: red"></i>
        </span>
    </button>
    <div [@sidebarContentState]="sidebarContentState" class="live-modeling-sidebar-content">
        <div *ngIf="liveModelingState === liveModelingStates.DISABLED" class="live-modeling-sidebar-page start-page">
            <p>Live modeling is currently disabled.</p>
            <button class="btn btn-warning font-weight-bold" (click)="enableLiveModeling()">Enable</button>
        </div>
        <div *ngIf="liveModelingState !== liveModelingStates.DISABLED" class="live-modeling-sidebar-page live-page">
            <div class="live-modeling-sidebar-section">
                <div class="d-flex">
                    <label class="live-modeling-sidebar-section-label flex-grow-1">General</label>
                    <i class="fa fa-gear ml-2" style="cursor: pointer;" tooltip="Settings" placement="left"
                       (click)="enableLiveModeling()"></i>
                </div>
                <div class="d-flex">
                    <div class="d-flex align-items-center justify-content-center icon-container">
                        <div *ngIf="currentCsar?.icon_url; then icon else iconPlaceholder"></div>
                        <ng-template #icon>
                            <img [src]="currentCsar.icon_url">
                        </ng-template>
                        <ng-template #iconPlaceholder>
                            <div class="icon-placeholder"></div>
                        </ng-template>
                    </div>
                    <div class="d-flex flex-column justify-content-center ml-2">
                        <div *ngIf="currentCsar?.name; then csarName else csarNamePlaceholder"></div>
                        <ng-template #csarName>
                            <span class="font-weight-bold">{{currentCsar.name}}</span>
                        </ng-template>
                        <ng-template #csarNamePlaceholder>
                            <div class="text-placeholder" style="width: 60px"></div>
                        </ng-template>
                        <div
                            *ngIf="currentCsar?.description; then csarDescription else csarDescriptionPlaceholder"></div>
                        <ng-template #csarDescription>
                            <span>{{currentCsar.description}}</span>
                        </ng-template>
                        <ng-template #csarDescriptionPlaceholder>
                            <div class="text-placeholder" style="width: 120px"></div>
                        </ng-template>
                        <div *ngIf="currentCsar?.version; then csarVersion else csarVersionPlaceholder"></div>
                        <ng-template #csarVersion>
                            <span class="font-italic">Version: {{currentCsar.version}}</span>
                        </ng-template>
                        <ng-template #csarVersionPlaceholder>
                            <div class="text-placeholder" style="width: 40px"></div>
                        </ng-template>
                    </div>
                </div>
            </div>
            <div class="live-modeling-sidebar-section">
                <label class="live-modeling-sidebar-section-label">Buildplan</label>
                <div class="table-scrollable">
                    <table class="table table-dark">
                        <thead>
                        <tr>
                            <th scope="col">Name</th>
                            <th scope="col">Value</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr *ngFor="let parameter of buildPlanInputParameters">
                            <td>{{parameter.name}}</td>
                            <td>{{parameter.value || '(empty)'}}</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="live-modeling-sidebar-section">
                <label class="live-modeling-sidebar-section-label">Operations</label>
                <div class="my-3">
                    <span>State: </span>
                    <span class="badge-small"
                          [style.background]="getBadgeBackgroundForState(serviceTemplateInstanceState)">{{serviceTemplateInstanceState | uppercase }}
                    </span>
                    <i class="fa fa-refresh ml-2" style="cursor: pointer;" tooltip="Refresh state" placement="top"
                       [class.disable-icon]="updatingServiceTemplateInstanceState"
                       [class.fa-spin]="updatingServiceTemplateInstanceState"
                       (click)="updateServiceTemplateInstanceState()"></i>
                </div>
                <div class="d-flex">
                    <button class="btn btn-danger flex-grow-1"
                            [disabled]="liveModelingState !== liveModelingStates.ENABLED"
                            (click)="disableLiveModeling()">
                        Disable
                    </button>
                    <button class="btn btn-info ml-2"
                            [disabled]="liveModelingState !== liveModelingStates.ENABLED"
                            (click)="refresh()"
                            tooltip="Refresh node template data"
                            placement="left">
                        <i class="fa fa-refresh"></i>
                    </button>
                </div>
            </div>
            <div class="live-modeling-sidebar-section d-flex flex-column">
                <div class="d-flex justify-content-end pb-1">
                    <!--                    <i class="fa fa-filter" style="cursor: pointer;" tooltip="Filter logs" placement="left"></i>-->
                    <i class="fa fa-trash ml-2" style="cursor: pointer;" tooltip="Clear logs" placement="left"
                       (click)="clearLogs()"></i>
                </div>
                <div #scrollContainer (scroll)="scrolled()" class="scroll-container">
                    <div class="log-container">
                        <div #logItems *ngFor="let log of logs; let last = last" class="log-item">
                            <span class="log-timestamp">{{log.timestamp}}</span>
                            <span class="log-message">
                                <span class="badge-xsmall"
                                      [style.background]="getBadgeBackgroundForLog(log.type)">{{log.type | uppercase }}</span>
                                {{log.message}}
                            </span>
                        </div>
                    </div>
                </div>
                <div class="progressbar-container">
                    <progressbar *ngIf="showProgressbar" class="progress-striped active" value="100"></progressbar>
                </div>
            </div>
        </div>
    </div>
</div>
