<!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  ~ Copyright (c) 2020 Contributors to the Eclipse Foundation
  ~
  ~ See the NOTICE file(s) distributed with this work for additional
  ~ information regarding copyright ownership.
  ~
  ~ This program and the accompanying materials are made available under the
  ~ terms of the Eclipse Public License 2.0 which is available at
  ~ http://www.eclipse.org/legal/epl-2.0, or the Apache Software License 2.0
  ~ which is available at https://www.apache.org/licenses/LICENSE-2.0.
  ~
  ~ SPDX-License-Identifier: EPL-2.0 OR Apache-2.0
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->

<form #exposedForm="ngForm" id="editPropertyForm">
    <div class="form-group">
        <label class="control-label" for="name">Name</label>
        <input #nameInputForm
               #propName="ngModel"
               id="name"
               class="form-control"
               type="text"
               [name]="isYaml ? 'name' : 'key'"
               autocomplete=off
               required
               [(ngModel)]="isYaml ? editedProperty.name : editedProperty.key"
               [wineryDuplicateValidator]="validatorObject"/>

        <div *ngIf="propName.errors && (propName.dirty || propName.touched)"
             class="alert alert-danger">
            <div [hidden]="!propName.errors.wineryDuplicateValidator">
                No duplicates allowed!
            </div>
            <div [hidden]="!propName.errors.required">
                Name is required
            </div>
        </div>
    </div>

    <div class="form-group">
        <label class="control-label" for="propType">Type</label>
        <select #selectProperty name="type" class="form-control" id="propType" [(ngModel)]="editedProperty.type">
            <option *ngFor="let type of availableTypes" value="{{ type }}">
                {{ type }}
            </option>
        </select>
    </div>
    <div class="form-group" *ngIf="selectProperty.value === 'map' || selectProperty.value === 'list'">
        <label class="control-label" for="entrySchema">Entry Schema</label>
        <!-- for now we do not support or condone nesting maps or lists -->
        <select #entrySchema name="entrySchema" class="form-control" id="entrySchema" [(ngModel)]="editedProperty.entrySchema.type">
            <option *ngFor="let type of availableTypes" value="{{ type }}">
                {{ type }}
            </option>
        </select>
    </div>
    <div class="form-group" *ngIf="selectProperty.value === 'map'">
        <label class="control-label" for="keySchema">Key Schema</label>
        <!-- for now we do not support or condone nesting maps or lists -->
        <select #keySchema name="keySchema" class="form-control" id="keySchema" [(ngModel)]="editedProperty.keySchema.type">
            <option *ngFor="let type of availableTypes" value="{{ type }}">
                {{ type }}
            </option>
        </select>
    </div>
    <div class="form-group">
        <label class="control-label" for="defaultValue">Default Value</label>
        <input #propertyDefaultValue id="defaultValue" class="form-control" type="text" [value]="editedProperty.defaultValue"/>
    </div>
    <div class="form-group">
        <input type="checkbox" id="isRequired" #propertyIsRequired style="margin-right: 7px" [checked]="editedProperty.required"/>
        <label class="control-label" for="isRequired">Is required</label>
    </div>
    <div class="form-group">
        <label class="control-label" for="description">Description</label>
        <input #propertyDescription id="description" class="form-control" type="text" [value]="editedProperty.description"/>
    </div>
    <div class="form-group">
        <label class="control-label" for="constraints">Constraints</label>
        <p>
        <div *ngFor="let constraintClause of editedProperty.constraints" id="constraints" class="constraintField">
            <span><b>{{constraintClause.key}}</b>:
                <span *ngIf="constraintClause.value != null">{{constraintClause.value}}</span>
                <span *ngIf="constraintClause.list != null">{{constraintClause.list.toString()}}</span>
                <button class="rightbutton btn btn-danger btn-xs" (click)="removeConstraint(constraintClause)">Delete</button>
            </span>
        </div>
    </div>
    <div class="form-group">
        <label class="control-label" for="constraintKey">Add new constraint</label><br>
        <select #selectedConstraintKey id="constraintKey">
            <option *ngFor="let item of valid_constraint_keys">{{ item }}</option>
        </select>
        <div *ngIf="list_constraint_keys.includes(selectedConstraintKey.value)">
            Please separate items by using ','
        </div>
        <div *ngIf="range_constraint_keys.includes(selectedConstraintKey.value)">
            Only two items are allowed.
        </div>
        <input #constraintValue id="constraintVal" class="form-control" type="text"/>
        <button type="button" class="btn btn-default"
                (click)="addConstraint(selectedConstraintKey.value, constraintValue.value)">
            Add Constraint
        </button>
    </div>
</form>
