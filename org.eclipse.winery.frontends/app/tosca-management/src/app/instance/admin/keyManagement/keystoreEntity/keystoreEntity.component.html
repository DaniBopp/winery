<!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  ~ Copyright (c) 2018-2019 Contributors to the Eclipse Foundation
  ~
  ~ See the NOTICE file(s) distributed with this work for additional
  ~ information regarding copyright ownership.
  ~
  ~ This program and the accompanying materials are made available under the
  ~ terms of the Eclipse Public License 2.0 which is available at
  ~ http://www.eclipse.org/legal/epl-2.0, or the Apache Software License 2.0
  ~ which is available at https://www.apache.org/licenses/LICENSE-2.0.
  ~
  ~ SPDX-License-Identifier: EPL-2.0 OR Apache-2.0
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
<div [class.hidden]="!loading">
    <winery-loader></winery-loader>
</div>
<div *ngIf="!loading">
    <winery-table *ngIf="keystoreEntityType !== 'keyexchange'" [columns]="columns[keystoreEntityType]"
                  [data]="data[keystoreEntityType]"
                  (cellSelected)="onCellSelect($event)"
                  (addBtnClicked)="onAddClick()"
                  [enableOtherPurposeButton]="true"
                  (otherPurposeBtnClicked)="onInfoClick()"
                  (removeBtnClicked)="onRemoveClick()">
    </winery-table>

    <div *ngIf="keystoreEntityType === 'keyexchange'" style="margin-top: 10px;">
        <div class="row">
            <ng-template #blockchainIdentityPopover>
                <p>The blockchain identity identifies the current user in the key exchange process. To change it, you
                    need to go to:
                    <em>Administration/Accountability/Configuration</em>
                    then you need change the active keystore and save the changes.
                </p>
            </ng-template>
            <label class="col-sm-2 control-label" [popover]="blockchainIdentityPopover" triggers="mouseenter:mouseleave"
                   popoverTitle="Description" placement="right">Blockchain Identity:</label>
            <div class="col-sm-10">
                <p>{{myIdentity}}</p>
            </div>

        </div>
        <div class="row" style="margin-top:10px;">
            <ng-template #officialKPPopover>
                <p>The official key pair is used in the key exchange process as follows:
                    The public key is used by the other participants to encrypt the permissions given to you, whereas
                    the private key is used by you to decrypt these permissions.
                    <b>Note:</b> the key pair should be of an Elliptic Curve (EC) type.
                </p>
            </ng-template>
            <label class="col-sm-2 control-label" [popover]="officialKPPopover" triggers="mouseenter:mouseleave"
                   popoverTitle="Description" placement="right">Official Key Pair Alias:</label>
            <div class="col-sm-10">
                <span *ngIf="myPublicKeyAlias === ''"
                      style="color: red;">not set!</span>
                <span *ngIf="myPublicKeyAlias !== ''">{{myPublicKeyAlias}}</span>
                <button type="button" class="btn-link"
                        (click)="showSetOfficialKeyPairModal()">
                    (set official key pair)
                </button>
            </div>
        </div>
        <div class="row" style="margin-top:10px;">
            <ng-template #givePermission>
                <p> This value indicates how many secret keys (permissions) were given to other participants. To find
                    out exactly which
                    keys they are you need to check the <em>Keys</em> tab.
                    You can also share further secret keys (permissions).
                </p>
            </ng-template>
            <label class="col-sm-2 control-label" [popover]="givePermission" triggers="mouseenter:mouseleave"
                   popoverTitle="Description" placement="right">Given Permissions:</label>
            <div class="col-sm-10">
                <span>{{givenPermissionsCount}}</span>
                <button class="btn-link" type="button"
                        (click)="showGivePermissionsModal()">
                    (give permissions to other participants)
                </button>
            </div>

        </div>
        <div class="row" style="margin-top:10px;">
            <ng-template #takenPermissions>
                <p> This value indicates how many secret keys (permissions) were given to you by other participants. To
                    find out exactly which
                    keys they are you need to check the <em>Keys</em> tab.
                    You can also update the set of taken keys to retrieve permissions newly given to you.
                </p>
            </ng-template>
            <label class="col-sm-2 control-label" [popover]="takenPermissions" triggers="mouseenter:mouseleave"
                   popoverTitle="Description" placement="right">Taken Permissions:</label>
            <div class="col-sm-10">
                <span>total: {{takenPermissionsTotalCount}}
                    - not retrieved yet: {{takenPermissionsNotAddedCount}}</span>
                <button class="btn-link" type="button"
                        (click)="updateTakenPermissions()">
                    (retrieve)
                </button>
            </div>
        </div>
    </div>

    <winery-modal bsModal #addKeyModal="bs-modal" [modalRef]="addKeyModal">
        <winery-modal-header [title]="'Add Key'">
        </winery-modal-header>
        <winery-modal-body>
            <form #addKeyForm="ngForm" id="addKeyForm">
                <div class="form-group">
                    <label>Algorithm</label>
                    <select class="form-control" name="algoList" [(ngModel)]="this.addKeyData.algorithm">
                        <option *ngFor="let algo of this.supportedAlgorithms" [ngValue]="algo">{{algo}}</option>
                    </select>
                </div>
                <div *ngIf="this.addKeyData && this.addKeyData.algorithm">
                    <div class="form-group">
                        <label>Key Size</label>
                        <select class="form-control" name="keySizesList"
                                [(ngModel)]="this.addKeyData.keySizeInBits">
                            <option
                                *ngFor="let keySize of this.supportedAlgorithmsKeySizesMap[this.addKeyData.algorithm]"
                                [ngValue]="keySize">{{keySize}}
                            </option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="keyUploader">Key file</label>
                    <input type="file" id="keyUploader" name="keyUploader" (change)="keySelected($event)"/>
                    <p class="help-block">File will be uploaded after clicking on "Save".</p>
                </div>
                <br/>
            </form>
        </winery-modal-body>
        <winery-modal-footer
            (onOk)="addKey(); addKeyForm.reset();"
            [closeButtonLabel]="'Cancel'"
            [okButtonLabel]="'Add'"
            [disableOkButton]="!(this.addKeyData.algorithm && this.addKeyData.keySizeInBits)">
        </winery-modal-footer>
    </winery-modal>

    <winery-modal bsModal #addKeypairModal="bs-modal" [modalRef]="addKeypairModal">
        <winery-modal-header [title]="'Add Keypair'">
        </winery-modal-header>
        <winery-modal-body>
            <form #addKeypairForm="ngForm" id="addKeypairForm">
                <div class="checkbox">
                    <label><input name="setAsMaster" [(ngModel)]="this.addKeypairData.setAsMaster" type="checkbox"
                    >Set As Master Signing Certificate</label>
                </div>

                <div class="form-group">
                    <label>Algorithm</label>
                    <select class="form-control" name="algoList" [(ngModel)]="this.addKeypairData.algorithm">
                        <option *ngFor="let algo of this.supportedAlgorithms" [ngValue]="algo">{{algo}}</option>
                    </select>
                </div>

                <hr>
                <label>Generate Private Key and Certificate</label>
                <div *ngIf="this.addKeypairData && this.addKeypairData.algorithm">
                    <div class="form-group">
                        <label>Key Size</label>
                        <select class="form-control" name="keySizesList"
                                [(ngModel)]="this.addKeypairData.keySizeInBits">
                            <option
                                *ngFor="let keySize of this.supportedAlgorithmsKeySizesMap[this.addKeypairData.algorithm]"
                                [ngValue]="keySize">{{keySize}}
                            </option>
                        </select>
                    </div>
                </div>

                <div>
                    <div class="form-group">
                        <label for="commonName">Common Name (CN)</label>
                        <input type="text" id="commonName" name="commonName" class="form-control"
                               [(ngModel)]="this.addKeypairData.commonName"/>
                    </div>
                    <div class="form-group">
                        <label for="oName">Organization Name (O)</label>
                        <input type="text" id="oName" name="oName" class="form-control"
                               [(ngModel)]="this.addKeypairData.organizationName"/>
                    </div>
                    <div class="form-group">
                        <label for="countryName">Country Name (C)</label>
                        <input type="text" id="countryName" name="countryName" class="form-control"
                               [(ngModel)]="this.addKeypairData.countryName"/>
                    </div>
                </div>
                <hr>
                <label>Load Private Key and Certificate</label>
                <div class="form-group">
                    <label for="privateKeyUploader">Private key file</label>
                    <input type="file" id="privateKeyUploader" name="privateKeyUploader"
                           (change)="keypairSelected($event)"/>
                    <p class="help-block">File will be uploaded after clicking on "Save".</p>
                </div>
                <div class="form-group">
                    <label for="certificateUploader">Certificate file</label>
                    <input type="file" id="certificateUploader" name="certificateUploader"
                           (change)="certificateSelected($event)"/>
                    <p class="help-block">File will be uploaded after clicking on "Save".</p>
                </div>
            </form>
        </winery-modal-body>
        <winery-modal-footer
            (onOk)="addKeypair(); addKeypairForm.reset();"
            [closeButtonLabel]="'Cancel'"
            [okButtonLabel]="'Add'"
            [disableOkButton]="!(
            this.addKeypairData?.algorithm && (
                ( this.addKeypairData.keySizeInBits && this.addKeypairData.commonName && this.addKeypairData.organizationName
                    && this.addKeypairData.countryName)
                    ||
                (this.addKeypairData.privateKeyFile && this.addKeypairData.certificateFile)
            )
            )">
        </winery-modal-footer>
    </winery-modal>

    <winery-modal bsModal #addCertificateModal="bs-modal" [modalRef]="addCertificateModal">
        <winery-modal-header [title]="'Add Certificate'">
        </winery-modal-header>
        <winery-modal-body>
            <form #addCertificateForm="ngForm" id="addCertificateForm">
                <div class="form-group">
                    <label for="certificateFileUploader">Certificate file</label>
                    <input type="file" id="certificateFileUploader" name="certificateFileUploader"
                           (change)="certificateSelected($event)"/>
                    <p class="help-block">File will be uploaded after clicking on "Save".</p>
                </div>
            </form>
        </winery-modal-body>
        <winery-modal-footer
            (onOk)="addCertificate(); addCertificateForm.reset();"
            [closeButtonLabel]="'Cancel'"
            [okButtonLabel]="'Add'"
            [disableOkButton]="!this.addCertificateData">
        </winery-modal-footer>
    </winery-modal>

    <winery-modal bsModal #confirmDeleteModal="bs-modal" [modalRef]="confirmDeleteModal">
        <winery-modal-header>
            <h4 class="modal-title">Delete Keystore Entity</h4>
        </winery-modal-header>
        <winery-modal-body>
            <p *ngIf="selectedCell != null" id="diagyesnomsg">
                Do you want to delete the following keystore entity <span
                style="font-weight:bold;">{{ selectedCell.row.alias}}</span>?
            </p>
        </winery-modal-body>
        <winery-modal-footer (onOk)="deleteEntity();"
                             [closeButtonLabel]="'No'"
                             [okButtonLabel]="'Delete'">
        </winery-modal-footer>
    </winery-modal>

    <winery-modal bsModal #keyInfoModal="bs-modal" [modalRef]="keyInfoModal">
        <winery-modal-header [title]="'Key Details'"></winery-modal-header>
        <winery-modal-body>
            <div *ngIf="selectedCell">
                <tabset>
                    <tab heading="Key Details" id="secretKeyDetailsTab">
                        <div class="panel panel-default">
                            <div class="panel-body">
                                <div class="row">
                                    <label class="col-sm-3 control-label">Alias:</label>
                                    <div class="col-sm-09">
                                        <p>{{selectedCell.row.alias}}</p>
                                    </div>
                                </div>
                                <div class="row">
                                    <label class="col-sm-3 control-label">Algorithm:</label>
                                    <div class="col-sm-09">
                                        <p>{{selectedCell.row.algorithm}}</p>
                                    </div>
                                </div>
                                <div class="row">
                                    <label class="col-sm-3 control-label">Format:</label>
                                    <div class="col-sm-09">
                                        <p>{{selectedCell.row.originalKey?.keyFormat}}</p>
                                    </div>
                                </div>
                                <div class="row">
                                    <label class="col-sm-3 control-label">Size (in bits):</label>
                                    <div class="col-sm-09">
                                        <p>{{selectedCell.row.originalKey?.keySizeInBits}}</p>
                                    </div>
                                </div>
                                <div *ngIf="selectedCell.row.originalKey?.base64Key" class="row">
                                    <label class="col-sm-3 control-label">Base64 encoded:</label>
                                    <div class="col-sm-09">
                                        <p>{{selectedCell.row.originalKey?.base64Key}}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </tab>
                    <tab heading="Key Exchange" id="secretKeyExchangeTab">
                        <div class="panel panel-default">
                            <div class="panel-body">
                                <div class="row">
                                    <label class="col-sm-3 control-label">Is Shared:</label>
                                    <div class="col-sm-09">
                                        <p>{{selectedCell.row.isShared ? 'Yes' : 'No'}}</p>
                                    </div>
                                </div>
                                <div class="row">
                                    <label class="col-sm-3 control-label">Taken From:</label>

                                    <div *ngIf="selectedCell.row.keyGivers?.length > 0" class="col-sm-09">
                                        <ul >
                                            <li *ngFor="let giver of selectedCell.row.keyGivers" >
                                                {{giver}}
                                            </li>
                                        </ul>
                                    </div>

                                    <div *ngIf="selectedCell.row.keyGivers?.length === 0" class="col-sm-09">
                                       <p style="color: red;">the key is not taken from other participants</p>
                                    </div>
                                </div>
                                <div class="row">
                                    <label class="col-sm-3 control-label">Given To:</label>
                                    <div *ngIf="selectedCell.row.keyTakers?.length > 0" class="col-sm-09">
                                        <ul >
                                            <li *ngFor="let taker of selectedCell.row.keyTakers" >
                                                {{taker}}
                                            </li>
                                        </ul>
                                    </div>

                                    <div *ngIf="selectedCell.row.keyTakers?.length === 0" class="col-sm-09">
                                        <p style="color: red;">the key is not given to other participants</p>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </tab>
                </tabset>

                <div [class.hidden]="!modalLoading">
                    <winery-loader></winery-loader>
                </div>
                <div *ngIf="!modalLoading">
                    <div *ngIf="selectedEntitySecPolicyTemplate; else generatePolicy">
                        <div class="update-nag">
                            <div class="update-split update-success"><i class="glyphicon glyphicon-ok"></i></div>
                            <div class="update-text">Encryption policy for this key is generated.</div>
                        </div>
                    </div>
                    <ng-template #generatePolicy>
                        <div class="update-nag">
                            <div class="update-split update-danger"><i class="glyphicon glyphicon-remove"></i></div>
                            <div class="update-text">Encryption policy does not exist! <a
                                (click)="generateEncryptionPolicy()">Generate</a></div>
                        </div>
                    </ng-template>
                </div>
            </div>
        </winery-modal-body>

        <winery-modal-footer
            [showDefaultButtons]="false">
            <button type="button" class="btn btn-primary" (click)="closeInfoModal()">Close</button>
        </winery-modal-footer>

    </winery-modal>

    <winery-modal bsModal #keypairInfoModal="bs-modal" [modalRef]="keypairInfoModal">
        <winery-modal-header [title]="'Keypair Details'"></winery-modal-header>
        <winery-modal-body>
            <div *ngIf="selectedCell && selectedCell.row.originalObject">
                <div *ngIf="selectedCell.row.originalObject.privateKey.alias!=='master'"
                     style="margin-bottom: 15px;">
                    <button type="button" class="btn btn-primary"
                            (click)="setAsMaster(selectedCell.row.originalObject.privateKey.alias)">
                        Set as Master
                    </button>
                </div>
                <div>
                    <tabset>
                        <tab heading="Private Key" id="tab1">
                            <div class="panel panel-default">
                                <div class="panel-body">
                                    <div class="row">
                                        <label class="col-sm-2 control-label">Alias:</label>
                                        <div class="col-sm-10">
                                            <p>{{selectedCell.row.originalObject.privateKey.alias}}</p>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <label class="col-sm-2 control-label">Algorithm:</label>
                                        <div class="col-sm-10">
                                            <p>{{selectedCell.row.originalObject.privateKey.algorithm}}</p>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <label class="col-sm-2 control-label">Format:</label>
                                        <div class="col-sm-10">
                                            <p>{{selectedCell.row.originalObject.privateKey.keyFormat}}</p>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <label class="col-sm-2 control-label">Size (in bits):</label>
                                        <div class="col-sm-10">
                                            <p>{{selectedCell.row.originalObject.privateKey.keySizeInBits}}</p>
                                        </div>
                                    </div>
                                    <div *ngIf="selectedCell.row.originalObject.privateKey.base64Key" class="row">
                                        <label class="col-sm-2 control-label">Base64 encoded:</label>
                                        <div class="col-sm-10">
                                            <p>{{selectedCell.row.originalObject.privateKey.base64Key}}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </tab>

                        <tab heading="Public Key">
                            <div class="panel panel-default">
                                <div class="panel-body">
                                    <div class="row">
                                        <label class="col-sm-2 control-label">Alias:</label>
                                        <div class="col-sm-10">
                                            <p>{{selectedCell.row.originalObject.publicKey.alias}}</p>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <label class="col-sm-2 control-label">Algorithm:</label>
                                        <div class="col-sm-10">
                                            <p>{{selectedCell.row.originalObject.publicKey.algorithm}}</p>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <label class="col-sm-2 control-label">Format:</label>
                                        <div class="col-sm-10">
                                            <p>{{selectedCell.row.originalObject.publicKey.keyFormat}}</p>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <label class="col-sm-2 control-label">Size (in bits):</label>
                                        <div class="col-sm-10">
                                            <p>{{selectedCell.row.originalObject.publicKey.keySizeInBits}}</p>
                                        </div>
                                    </div>
                                    <div *ngIf="selectedCell.row.originalObject.publicKey.base64Key" class="row">
                                        <label class="col-sm-2 control-label">Base64 encoded:</label>
                                        <div class="col-sm-10">
                                            <p>{{selectedCell.row.originalObject.publicKey.base64Key}}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </tab>

                        <tab heading="Certificate">
                            <div class="panel panel-default">
                                <div class="panel-body">
                                    <div class="row">
                                        <label class="col-sm-2 control-label">Alias:</label>
                                        <div class="col-sm-10">
                                            <p>{{selectedCell.row.originalObject.certificate.alias}}</p>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <label class="col-sm-2 control-label">Serial Number:</label>
                                        <div class="col-sm-10">
                                            <p>{{selectedCell.row.originalObject.certificate.serialNumber}}</p>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <label class="col-sm-2 control-label">Signature Algorithm:</label>
                                        <div class="col-sm-10">
                                            <p>{{selectedCell.row.originalObject.certificate.sigAlgName}}</p>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <label class="col-sm-2 control-label">Issuer:</label>
                                        <div class="col-sm-10">
                                            <p>{{selectedCell.row.originalObject.certificate.issuerDN}}</p>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <label class="col-sm-2 control-label">Subject:</label>
                                        <div class="col-sm-10">
                                            <p>{{selectedCell.row.originalObject.certificate.subjectDN}}</p>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <label class="col-sm-2 control-label">Subject:</label>
                                        <div class="col-sm-10">
                                            <p>{{selectedCell.row.originalObject.certificate.notBefore}}</p>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <label class="col-sm-2 control-label">Subject:</label>
                                        <div class="col-sm-10">
                                            <p>{{selectedCell.row.originalObject.certificate.notAfter}}</p>
                                        </div>
                                    </div>
                                    <div *ngIf="selectedCell.row.originalObject.certificate.pem" class="row">
                                        <label class="col-sm-2 control-label">Base64 encoded:</label>
                                        <div class="col-sm-10">
                                            <p>{{selectedCell.row.originalObject.certificate.pem}}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </tab>
                    </tabset>
                </div>
                <div [class.hidden]="!modalLoading">
                    <winery-loader></winery-loader>
                </div>
                <div *ngIf="!modalLoading">
                    <div *ngIf="selectedEntitySecPolicyTemplate; else generatePolicy">
                        <div class="update-nag">
                            <div class="update-split update-success"><i class="glyphicon glyphicon-ok"></i></div>
                            <div class="update-text">Signing policy for this keypair is generated.</div>
                        </div>
                    </div>
                    <ng-template #generatePolicy>
                        <div class="update-nag">
                            <div class="update-split update-danger"><i class="glyphicon glyphicon-remove"></i></div>
                            <div class="update-text">Signing policy does not exist! <a
                                (click)="generateSigningPolicy()">Generate</a></div>
                        </div>
                    </ng-template>
                </div>

            </div>
        </winery-modal-body>

        <winery-modal-footer
            [showDefaultButtons]="false">
            <button type="button" class="btn btn-primary" (click)="closeInfoModal()">Close</button>
        </winery-modal-footer>

    </winery-modal>

    <winery-modal bsModal #certificateInfoModal="bs-modal" [modalRef]="certificateInfoModal">
        <winery-modal-header [title]="'Certificate Details'"></winery-modal-header>
        <winery-modal-body>
            <div *ngIf="selectedCell">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <label class="control-label">Certificate details</label>
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            <label class="col-sm-2 control-label">Alias:</label>
                            <div class="col-sm-10">
                                <p>{{selectedCell.row.alias}}</p>
                            </div>
                        </div>
                        <div class="row">
                            <label class="col-sm-2 control-label">Serial Number:</label>
                            <div class="col-sm-10">
                                <p>{{selectedCell.row.serialNumber}}</p>
                            </div>
                        </div>
                        <div class="row">
                            <label class="col-sm-2 control-label">Issuer:</label>
                            <div class="col-sm-10">
                                <p>{{selectedCell.row.issuerDN}}</p>
                            </div>
                        </div>
                        <div class="row">
                            <label class="col-sm-2 control-label">Subject:</label>
                            <div class="col-sm-10">
                                <p>{{selectedCell.row.subjectDN}}</p>
                            </div>
                        </div>
                        <div class="row">
                            <label class="col-sm-2 control-label">Valid From:</label>
                            <div class="col-sm-10">
                                <p>{{selectedCell.row.notBefore}}</p>
                            </div>
                        </div>
                        <div class="row">
                            <label class="col-sm-2 control-label">Valid Until:</label>
                            <div class="col-sm-10">
                                <p>{{selectedCell.row.notAfter}}</p>
                            </div>
                        </div>
                        <div class="row">
                            <label class="col-sm-2 control-label">PEM:</label>
                            <div class="col-sm-10">
                                <p>{{selectedCell.row.pem}}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </winery-modal-body>

        <winery-modal-footer
            [showDefaultButtons]="false">
            <button type="button" class="btn btn-primary" (click)="certificateInfoModal.hide()">Close</button>
        </winery-modal-footer>

    </winery-modal>

    <winery-modal bsModal #setOfficialKeypairModal="bs-modal" [modalRef]="setOfficialKeypairModal">
        <winery-modal-header [title]="'Set Official Key Pair Alias'"></winery-modal-header>
        <winery-modal-body>
            <label class="control-label">Available Key Pair Aliases:</label>
            <ng-select id="keypairAliasSelect" [items]="getKeyPairAliases()"
                       (selected)="onAliasSelected($event)"
                       [active]="selectedPublicKeyAlias !== undefined?[selectedPublicKeyAlias]:[]"></ng-select>
            <br/>
        </winery-modal-body>
        <winery-modal-footer
            [showDefaultButtons]="true" [okButtonLabel]="'Set'" [closeButtonLabel]="'Cancel'"
            (onOk)="setOfficialKeyPair()">

        </winery-modal-footer>
    </winery-modal>

    <winery-modal bsModal #givePermissionsModal="bs-modal" [modalRef]="givePermissionsModal">
        <winery-modal-header [title]="'Give Permissions to Other Participants'"></winery-modal-header>
        <winery-modal-body>
            <form #givePermissionsForm="ngForm">
                <div class="form-group">
                    <label for="secretKeyAliasSelect" class="control-label">Secret Key (Permission) Alias:</label>
                    <ng-select id="secretKeyAliasSelect" [items]="getSecretKeyAliases()"
                               (selected)="onSKAliasSelected($event)"
                               [active]="selectedSecretKeyAlias !== undefined?[selectedSecretKeyAlias]:[]"></ng-select>
                    <br/>
                    <label for="blockchainAddress" class="control-label">Participant Blockchain Address:</label>
                    <input type="text" id="blockchainAddress" class="form-control" name="blockchainAddress"
                           pattern="^0x[a-fA-F0-9]{40}$"
                           [(ngModel)]="selectedParticipant" required>
                    <br/>
                </div>
            </form>
        </winery-modal-body>
        <winery-modal-footer
            [showDefaultButtons]="true"
            [disableOkButton]="!givePermissionsForm.valid || selectedSecretKeyAlias === undefined"
            [okButtonLabel]="'Set'" [closeButtonLabel]="'Cancel'" (onOk)="givePermission()">
        </winery-modal-footer>
    </winery-modal>
</div>
